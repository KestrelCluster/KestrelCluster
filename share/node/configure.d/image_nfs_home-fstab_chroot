#!/bin/bash

# Adds an entry on the fstab file of the image, to mount the nfs4 exported
# home directory

# Check if we should mount the home directory using a nfs4 export
[ "${NFS4_HOME}" == "true" ] || exit 0

comment="# Autogenerated by kestrel_reconfigure"

if ! grep -q "${comment}" /etc/fstab; then
    echo -e "\n${comment}" >> /etc/fstab
fi

# Delete the old fstab's home entry
sed -ri "/kestrel.*home[[:space:]]+/d" /etc/fstab

# Add the new entry after the comment
sed -ri "/${comment}/a\
${FRONTEND_IP}:/kestrel/home \t/home \tnfs4 \t_netdev,auto \t0 \t0 \
" /etc/fstab

