#!/bin/bash

# Adds an entry on the fstab file of the image, to mount the nfs4 exported
# home directory

# Check if we should mount the home directory using a nfs4 export
if [[ "${HOME_FS}" =~ ^nfs[34]*$ ]]; then

    comment="# Autogenerated by kestrel_reconfigure"

    if ! grep -q "${comment}" ${FILE}; then
        echo -e "\n${comment}" >> ${FILE}
    fi

    # Delete the old fstab's home entry
    sed -ri "/kestrel\/home[[:space:]]+/d" ${FILE}

    # Add the new entry after the comment
    options="\t_netdev,auto \t0 \t0"
    sed -ri "/${comment}/a\
${FRONTEND_IP}:/kestrel/home \t/${KESTREL_HOME} \t${HOME_FS} ${options}" ${FILE}

    [ ! -d ${KESTREL_HOME} ] && mkdir ${HOME_MODE}
    
fi
